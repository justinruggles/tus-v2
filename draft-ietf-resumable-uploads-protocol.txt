



TODO Working Group                                             M. Kleidl
Internet-Draft                                           Transloadit Ltd
Intended status: Informational                          12 November 2020
Expires: 16 May 2021


                    tus - Resumable Uploads Protocol
              draft-ietf-resumable-uploads-protocol-latest

Abstract

   TODO Abstract

Discussion Venues

   This note is to be removed before publishing as an RFC.

   Discussion of this document takes place on the RESUMABLE Working
   Group mailing list (resumable@ietf.org), which is archived at
   https://mailarchive.ietf.org/arch/browse/resumable/.

   Source for this draft and an issue tracker can be found at
   https://github.com/tus/tus-v2.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on 16 May 2021.

Copyright Notice

   Copyright (c) 2020 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents (https://trustee.ietf.org/
   license-info) in effect on the date of publication of this document.
   Please review these documents carefully, as they describe your rights
   and restrictions with respect to this document.  Code Components
   extracted from this document must include Simplified BSD License text
   as described in Section 4.e of the Trust Legal Provisions and are
   provided without warranty as described in the Simplified BSD License.

Table of Contents

   1.  Introduction
   2.  Conventions and Definitions
   3.  Uploading Procedure
     3.1.  Upload Creation Procedure
     3.2.  Offset Retriving Procedure
     3.3.  Upload Appending Procedure
     3.4.  Upload Cancellation Procedure
   4.  Header Fields
     4.1.  The Upload-Token Header Field
     4.2.  The Upload-Index Header Field
     4.3.  The Upload-Offset Header Field
   5.  Service Discovery
   6.  Security Considerations
   7.  IANA Considerations
   8.  Normative References
   Acknowledgments
   Author's Address

1.  Introduction

   HTTP already provides resumable downloads using the "Range" header.
   However, on its own HTTP does not contain a standardized mechanism
   for resumable uploads.  This has lead to a situation where many web
   services implement a proprietary solution for handling connection
   issues during file uploads.  Such a scattered landscape makes it
   impossible to develop clients with resumable upload capabilities in a
   generic approach without focusing on specific, proprietary solutions.
   It also limits the benefits of resumable uploads to web services that
   can free up the resources to implement this.

   Resuming a previously interrupted upload continues the data transfer
   where it left off, without the need to transfer the first part again.
   This capability is especially important in applications handling
   large files or operating in areas with unreliable network
   infrastructure.  Upload interruptions can occur voluntarily, i.e. the
   end-user wants to pause the upload, or involuntarily, i.e. the
   network connection drops.

   This protocol specifies an approach for clients and servers to
   implement resumable uploads on top of HTTP/1.1 and HTTP/2, allowing
   the reuse of existing infrastructure.

2.  Conventions and Definitions

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in BCP
   14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.

3.  Uploading Procedure

   The uploading of a file using the Resumable Uploads Protocol consists
   of multiple procedures: 1.  The Upload Creation Procedure notifies
   the server that the client wants to begin an upload.  The server
   should then reserve the required resources to accept the upload from
   the client.  The client also begins transferring the file in the
   request body. 2.  If the connection to the server gets intrrupted
   during the Upload Creation Procedure or the Upload Appending
   Procedure, the client may want to resume the upload.  Before this is
   possible, the client must know the amount of data that the server was
   able to receive before the connection got interrupted.  To achieve
   this, the client uses the Offset Retriving Procedure to obtain the
   upload's offset. 3.  After the Offset Retriving Procedure completes,
   the client can resume the upload by sending the remaining file
   content to the server, appending to the already stored data in the
   upload. 4.  If the client is not interesting in completing the upload
   anymore, it can instruct the server to delete the upload and free all
   related resources using the Upload Cancellation Procedure.

   TODO: Add flow chart

3.1.  Upload Creation Procedure

   In order to initiate a resumable upload, the client MUST send a
   "POST" request to a known upload URL, under which endpoint the server
   supports resumable uploads as laid out in this document.  Possible
   approaches for the client to obtain this upload URL as presented in
   the section Service Discovery.  This "POST" request MUST include the
   Upload-Token header and have it set to a unique value (TODO: More
   constraint to ensure its uniqueness).

   The client SHOULD include the file's content in the request body and
   the server MUST attempt to store as much data as possible to minimize
   the data loss if the connection between the client and server get
   interrupted.

   If the request completes successfully, the server MUST acknowledge it
   by responding with the "204 No Content" status code.

   ``` POST /uploads HTTP/1.1 Host: example.org Upload-Token: abcdef
   Content-Length: ...

   [file content]

   HTTP/1.1 204 No Content ```

3.2.  Offset Retriving Procedure

   TODO: Request details TODO: Should interrupt other running PATCH
   requests

   ``` HEAD /uploads HTTP/1.1 Host: example.org Upload-Token: abcdef
   Content-Length: 0

   HTTP/1.1 204 No Content Upload-Offset: 100 ```

3.3.  Upload Appending Procedure

   TODO: Request details TODO: Should interrupt other running PATCH
   requests

   ``` PATCH /uploads HTTP/1.1 Host: example.org Upload-Token: abcdef
   Upload-Offset: 100

   [file content]

   HTTP/1.1 204 No Content Upload-Offset: 200 ```

3.4.  Upload Cancellation Procedure

   TODO: Request details TODO: Should interrupt other running PATCH
   requests

   ``` DELETE /uploads HTTP/1.1 Host: example.org Upload-Token: abcdef
   Content-Length: 0

   HTTP/1.1 204 No Content ```

4.  Header Fields

4.1.  The Upload-Token Header Field

4.2.  The Upload-Index Header Field

4.3.  The Upload-Offset Header Field

5.  Service Discovery

   TODO Discovery using the "Alt-Svc" header and/or "HTTPSSVC" DNS
   record

6.  Security Considerations

   TODO Recommendation for HTTPS TODO Recommendation for Authentication
   TODO Recommendation for ensuring unique tokens

7.  IANA Considerations

   This document has no IANA actions.

8.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.

Acknowledgments

   TODO acknowledge.

Author's Address

   Marius Kleidl
   Transloadit Ltd

   Email: marius@transloadit.com
